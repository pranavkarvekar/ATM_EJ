{% extends 'base.html' %}

{% block title %}Transactions - ATM EJ Parser{% endblock %}

{% block content %}
<div class="max-w-screen-2xl mx-auto px-8 py-10">

    <!-- Search & Filter -->
    <div>
        <div class="bg-zinc-900 border border-zinc-800 rounded-3xl p-8 mb-8">

            <!-- ONE ROW GRID -->
            <div class="grid grid-cols-12 gap-6 items-end">

                <!-- SEARCH -->
                <form method="get" class="col-span-6">
                    <div class="text-xs font-mono uppercase tracking-widest text-zinc-500 mb-2">
                        SEARCH TRANSACTIONS
                    </div>
                    <input
                        type="text"
                        name="q"
                        value="{{ search_query }}"
                        placeholder="Search date, type, ATM ID, card number..."
                        class="w-full bg-zinc-950 border border-zinc-700 focus:border-blue-600 rounded-2xl px-5 py-3.5 text-sm text-white"
                    >
                </form>



                <!-- STATUS -->
                <form method="get" class="col-span-4">
                    <input type="hidden" name="q" value="{{ search_query }}">
                    <div class="text-xs font-mono uppercase tracking-widest text-zinc-500 mb-2">
                        STATUS FILTER
                    </div>
                    <select
                        name="status"
                        onchange="this.form.submit()"
                        class="w-full bg-zinc-950 border border-zinc-700 focus:border-blue-600 rounded-2xl px-5 py-3.5 text-sm text-white"
                    >
                        <option value="all" {% if status_filter == "all" %}selected{% endif %}>All</option>
                        <option value="success" {% if status_filter == "success" %}selected{% endif %}>Success</option>
                        <option value="failed" {% if status_filter == "failed" %}selected{% endif %}>Failed</option>
                        <option value="INCOMPLETE" {% if status_filter == "INCOMPLETE" %}selected{% endif %}>INCOMPLETE</option>
                        <option value="ABANDONED" {% if status_filter == "ABANDONED" %}selected{% endif %}>ABANDONED</option>
                        <option value="reversed" {% if status_filter == "reversed" %}selected{% endif %}>Reversed</option>
                    </select>
                </form>

                <!-- EXPORT -->
                <form method="get" class="col-span-2 flex items-end">
                    <input type="hidden" name="q" value="{{ search_query }}">
                    <input type="hidden" name="status" value="{{ status_filter }}">
                    <button
                        type="submit"
                        name="export"
                        value="csv"
                        class="w-full bg-zinc-800 hover:bg-zinc-700 border border-zinc-700 text-white rounded-2xl py-3.5"
                    >
                        Export CSV
                    </button>
                </form>

            </div>

            <!-- FOOTER TEXT -->
            <div class="text-xs text-zinc-500 mt-4">
                Showing {{ filtered_count }} of {{ total_count }} transactions
            </div>

        </div>


    </div>

    <!-- Table -->
    <div class="bg-zinc-900 border border-zinc-800 rounded-3xl overflow-hidden">
        
        <!-- Card header -->
        <div class="px-8 py-5 border-b border-zinc-800 bg-zinc-950/50 flex justify-between items-center">
            <div class="uppercase text-xs font-mono tracking-widest text-zinc-400">
                TRANSACTIONS
            </div>
        </div>

        <!-- ðŸ”¥ Horizontal scroll container -->
        <div class="overflow-x-auto">
            <table class="min-w-full">
                <thead>
                    <tr class="bg-zinc-950 border-b border-zinc-800">
                        <th class="px-8 py-5 text-left text-xs font-medium text-zinc-400 uppercase tracking-wider">Date â†“</th>
                        <th class="px-8 py-5 text-left text-xs font-medium text-zinc-400 uppercase tracking-wider">Time â†“</th>
                        <th class="px-8 py-5 text-left text-xs font-medium text-zinc-400 uppercase tracking-wider">Card / ATM ID</th>
                        <th class="px-8 py-5 text-left text-xs font-medium text-zinc-400 uppercase tracking-wider">Type</th>
                        <th class="px-8 py-5 text-left text-xs font-medium text-zinc-400 uppercase tracking-wider">Amount (â‚¹)</th>
                        <th class="px-8 py-5 text-left text-xs font-medium text-zinc-400 uppercase tracking-wider">Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% if transactions %}
                        {% for txn in transactions %}
                        <tr class="border-b border-zinc-800 hover:bg-zinc-900 transition">

                            <td class="px-8 py-5 text-sm text-zinc-200">{{txn.date}}</td>
                            <td class="px-8 py-5 text-sm text-zinc-200">{{txn.time}}</td>
                            <td class="px-8 py-5 text-sm text-zinc-200">
                                {% if txn.card_no %}
                                    {{ txn.card_no }}
                                {% else %}
                                    {{ txn.terminal_id|default:"UNKNOWN" }}
                                {% endif %}
                            </td>
                            <td class="px-8 py-5 text-sm text-zinc-200">{{ txn.txn_type }}</td>
                            <td class="px-8 py-5 text-sm text-zinc-200">{{txn.amount}}</td>

                          
                            <td class="px-8 py-5">
                                {% if txn.status == "SUCCESS" %}
                                    <span class="px-3 py-1 rounded-full text-xs font-semibold bg-emerald-900 text-emerald-300">
                                        SUCCESS
                                    </span>
                                {% elif txn.status == "FAILED" %}
                                    <span class="px-3 py-1 rounded-full text-xs font-semibold bg-red-900 text-red-300">
                                        FAILED
                                    </span>
                                {% else %}
                                    <span class="px-3 py-1 rounded-full text-xs font-semibold bg-zinc-800 text-zinc-300">
                                        {{ txn.status }}
                                    </span>
                                {% endif %}
                            </td>
                        </tr>
                        
                    {% endfor %}
                    {% else %}
                    <tr>
                        <td colspan="6" class="py-24">
                            <div class="flex flex-col items-center text-center">
                                <div class="w-20 h-20 bg-zinc-800 rounded-3xl flex items-center justify-center mb-6">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10 text-zinc-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3" />
                                    </svg>
                                </div>

                                <div class="text-zinc-400 font-medium">No transactions found</div>
                                <div class="text-zinc-500 mt-1">Upload an EJ file or adjust filters</div>
                            </div>
                        </td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}